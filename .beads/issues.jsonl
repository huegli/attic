{"id":"attic-08d","title":"1. AtticServer Tests","description":"Manual testing for AtticServer startup, custom ROM paths, and shutdown","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:16.161866-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:16.161866-08:00"}
{"id":"attic-08d.1","title":"1.1 Server Startup","description":"Test server starts without errors, displays correct port messages, creates CLI socket, ROM discovery works","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:14.331446-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:14.331446-08:00","dependencies":[{"issue_id":"attic-08d.1","depends_on_id":"attic-08d","type":"parent-child","created_at":"2026-01-20T12:23:14.333907-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-08d.2","title":"1.2 Server with Custom ROM Path","description":"Test --rom-path flag works, error message if ROMs not found","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:14.533057-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:14.533057-08:00","dependencies":[{"issue_id":"attic-08d.2","depends_on_id":"attic-08d","type":"parent-child","created_at":"2026-01-20T12:23:14.533745-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-08d.3","title":"1.3 Server Shutdown","description":"Test Ctrl+C graceful shutdown, socket file removal, client connections closed","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:14.721193-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:14.721193-08:00","dependencies":[{"issue_id":"attic-08d.3","depends_on_id":"attic-08d","type":"parent-child","created_at":"2026-01-20T12:23:14.721801-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-09d","title":"MCP server for direct emulator access from Claude Code","description":"## Motivation\n\nDuring debugging of keyboard injection (attic-8qi, attic-ahr), direct access to the emulator from Claude Code would have significantly accelerated troubleshooting. Currently, debugging requires:\n\n1. Running AtticServer and CLI as separate processes\n2. Using CLI commands to inspect memory (slow, indirect)\n3. Manually decoding values (screen codes, BASIC pointers)\n4. Switching modes just to check state\n5. No ability to step frames and inspect state interactively\n\n## Proposed Solution\n\nCreate an MCP server that exposes EmulatorEngine capabilities directly to Claude Code.\n\n## Suggested Tools\n\n### Memory Operations\n- `emulator_read_memory(address, count)` - Read bytes from emulator memory\n- `emulator_write_memory(address, bytes)` - Write bytes to memory\n- `emulator_read_word(address)` - Read 16-bit little-endian value\n\n### CPU State\n- `emulator_get_registers()` - Get PC, A, X, Y, SP, status flags\n- `emulator_set_registers(pc?, a?, x?, y?, sp?)` - Modify registers\n\n### Frame Control\n- `emulator_execute_frames(count)` - Run N frames\n- `emulator_step()` - Execute single frame with full state return\n\n### Input\n- `emulator_press_key(keyCode, shift?, control?)` - Simulate key press\n- `emulator_release_key()` - Release current key\n- `emulator_inject_string(text)` - Type a string (for testing)\n\n### Display\n- `emulator_get_screen()` - Get screen as text (decoded from screen codes)\n- `emulator_get_screen_raw()` - Get raw screen memory bytes\n\n### BASIC State\n- `emulator_get_basic_state()` - Return BASIC pointers (STMTAB, STARP, VNTP, etc.)\n- `emulator_list_program()` - Get current BASIC program listing\n\n### Emulator Control\n- `emulator_reset(cold?)` - Reset emulator\n- `emulator_get_status()` - Get run state, PC, frame count\n\n## Benefits\n\n1. **Faster debugging** - Direct inspection without CLI overhead\n2. **Interactive exploration** - Step through frames, check state, adjust\n3. **Automated testing** - Claude can write and run emulator tests\n4. **Better understanding** - See exactly what libatari800 is doing\n\n## Implementation Notes\n\n- Could extend existing AtticServer or be a separate lightweight server\n- Should connect to running EmulatorEngine instance\n- Consider read-only vs read-write tool separation for safety\n- May want to expose as both MCP tools and CLI commands for flexibility\n\n## Related Issues\n\n- attic-ahr: Keyboard injection debugging would have been much easier\n- attic-0vu: Memory injection debugging would benefit\n- attic-8qi: Testing different injection approaches interactively","status":"open","priority":2,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-03T10:45:01.837293-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-03T10:45:01.837293-08:00"}
{"id":"attic-0de","title":"6. CLI Protocol Tests","description":"Manual testing for socket communication, memory operations, and register operations","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:16.936937-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:16.936937-08:00","dependencies":[{"issue_id":"attic-0de","depends_on_id":"attic-2xm","type":"blocks","created_at":"2026-01-20T12:22:42.689984-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-0de.1","title":"6.1 Socket Communication","description":"Test via socat: ping/pong, pause/paused, resume/resumed, status, reset cold, invalid command error","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:41.030613-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:41.030613-08:00","dependencies":[{"issue_id":"attic-0de.1","depends_on_id":"attic-0de","type":"parent-child","created_at":"2026-01-20T12:23:41.031233-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-0de.2","title":"6.2 Memory Operations","description":"Test CMD:read, CMD:write, verify written bytes","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:41.227114-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:41.227114-08:00","dependencies":[{"issue_id":"attic-0de.2","depends_on_id":"attic-0de","type":"parent-child","created_at":"2026-01-20T12:23:41.227724-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-0de.3","title":"6.3 Register Operations","description":"Test CMD:registers show all, CMD:registers A=$50 sets register, verify","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:41.425944-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:41.425944-08:00","dependencies":[{"issue_id":"attic-0de.3","depends_on_id":"attic-0de","type":"parent-child","created_at":"2026-01-20T12:23:41.426628-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-0iv","title":"9. ATR/DOS Tests","description":"Manual testing for disk mounting, directory operations, file operations, and disk creation","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:26.570163-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:26.570163-08:00","dependencies":[{"issue_id":"attic-0iv","depends_on_id":"attic-d6l","type":"blocks","created_at":"2026-01-20T12:22:48.900737-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-0iv.1","title":"9.1 Disk Mounting","description":"Test mount single/enhanced/double/quad density disks, invalid file error","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:55.994053-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:55.994053-08:00","dependencies":[{"issue_id":"attic-0iv.1","depends_on_id":"attic-0iv","type":"parent-child","created_at":"2026-01-20T12:23:55.994611-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-0iv.2","title":"9.2 Directory Operations","description":"Test list all files, wildcard patterns (*.COM, TEST?.BAS), file sizes, locked files marked","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:56.20743-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:56.20743-08:00","dependencies":[{"issue_id":"attic-0iv.2","depends_on_id":"attic-0iv","type":"parent-child","created_at":"2026-01-20T12:23:56.207999-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-0iv.3","title":"9.3 File Operations","description":"Test read (type), hex dump (dump), export to host, import from host, delete, rename, lock/unlock","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:08.514459-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:08.514459-08:00","dependencies":[{"issue_id":"attic-0iv.3","depends_on_id":"attic-0iv","type":"parent-child","created_at":"2026-01-20T12:24:08.516921-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-0iv.4","title":"9.4 Disk Creation","description":"Test create new single/enhanced/double density disks, format existing disk","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:08.73758-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:08.73758-08:00","dependencies":[{"issue_id":"attic-0iv.4","depends_on_id":"attic-0iv","type":"parent-child","created_at":"2026-01-20T12:24:08.738257-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-0k7","title":"Let's make even more beads","status":"closed","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-23T16:02:59.621924-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-28T21:06:45.320316-08:00","closed_at":"2026-01-28T21:03:37.543162-08:00"}
{"id":"attic-0vu","title":"CLI line injection writes to wrong address when new variables are introduced","description":"## Critical Bug: Memory Corruption in Line Injection\n\nTwo issues were found:\n\n### Issue 1: Position calculated before variable addition (FIXED)\nWhen lines introduce new variables, position was calculated with old state.\n\n### Issue 2: Race condition - frames execute during \"pause\" (FIXED)\nThe `executeFrame()` method did not check the paused state, so the server kept executing frames while CLI was modifying memory.\n\n**Root cause of GUI hang:** CLI calls `pause()`, but server keeps calling `executeFrame()` which executes anyway. Memory gets corrupted by concurrent modification.\n\n## Fixes Applied\n\n1. Restructured `injectLine()` to add variables BEFORE calculating position\n2. Added `guard shouldRun else { return .ok }` to `executeFrame()` to actually stop execution when paused\n\n## Files Modified\n\n- `Sources/AtticCore/BASICLineHandler.swift` - Fixed variable/position ordering\n- `Sources/AtticCore/EmulatorEngine.swift` - Added pause check to executeFrame()","notes":"### Debugging Session 2026-02-03\n\n**Major progress:** Identified root cause of GUI hang after CLI line injection.\n\n#### Key Discovery: `initializeBASICMemory` Was Corrupting BASIC's State\n\nWhen CLI enters a line and MEMTOP appears too low ($0804), we were calling `initializeBASICMemory` which reset ALL BASIC pointers:\n- Changed STMTAB from $0801 to $0701\n- Changed VNTP/VNTD/VVTP accordingly\n- This corrupted BASIC's view of where its program storage is\n\nBASIC had set up its own memory layout:\n- VNTP=$0800, VNTD=$0800, VVTP=$0801, STMTAB=$0801\n- This is different from what we were forcing ($0700/$0700/$0701/$0701)\n\n#### PC Trace Evidence\n\nWhen the hang occurred:\n- Before Return: PC=$F2FD-$F310 (OS keyboard input loop - normal)\n- After Return: PC=$A9B6-$A9DB (stuck in BASIC ROM execution loop)\n- STMCUR changed to $070E (pointing past our corrupted program area)\n\n#### Fix Applied\n\nChanged `initializeBASICMemory` call to only fix MEMTOP and RUNSTK, leaving all other pointers (STMTAB, VNTP, VVTP, etc.) as BASIC set them:\n\n```swift\n// Only fix MEMTOP and RUNSTK - leave all other pointers alone!\nawait emulator.writeWord(at: BASICPointers.memtop, value: memtop)\nawait emulator.writeWord(at: BASICPointers.runstk, value: memtop)\n```\n\n#### Result\n\n- **BASIC no longer hangs!** It responds to input again\n- PC returns to keyboard input loop after processing\n- But now get \"ERROR- 2\" (Out of memory) when typing immediate commands in GUI\n\n#### Remaining Issue\n\nThe \"Out of memory\" error suggests there's still some memory-related state that needs attention:\n- Possibly APPMHI ($0A-0B) needs to be updated\n- Possibly other cached values in BASIC's zero page\n- The injection itself may be putting data at wrong location given BASIC's actual layout\n\n#### Files Modified This Session\n\n- `Sources/AtticCore/BASICLineHandler.swift` - Conservative MEMTOP/RUNSTK fix only\n- `Sources/AtticServer/AtticServer.swift` - Added debug output for PC, STMTAB, STARP, STMCUR\n\n#### Next Steps\n\n1. Debug why \"Out of memory\" occurs - check if STARP is being updated correctly\n2. Verify injected line is at correct address given BASIC's STMTAB=$0801\n3. Check if APPMHI or other OS-level memory pointers need updating\n4. Consider whether the CLI should work with BASIC's existing layout rather than trying to fix \"invalid\" values","status":"closed","priority":1,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-02T17:19:27.842085-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-03T10:09:31.497403-08:00","closed_at":"2026-02-03T10:09:31.497403-08:00","close_reason":"Superseded by attic-8qi: keyboard injection replaces memory injection, avoiding the memory corruption entirely"}
{"id":"attic-1f9","title":"Another beads","status":"tombstone","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-22T18:20:13.615476-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-22T19:47:41.586945-08:00","deleted_at":"2026-01-22T19:47:41.586945-08:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"attic-1s8","title":"Maybe I need another beads","status":"closed","priority":1,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T22:53:24.810142-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-21T09:41:18.687382-08:00","closed_at":"2026-01-21T09:41:18.687382-08:00","close_reason":"Closed"}
{"id":"attic-23s","title":"swift test hangs on testServerPauseCommand","description":"Running 'swift test' hangs indefinitely at AtticServerSubprocessTests.testServerPauseCommand. All previous tests pass successfully (including testClientCanConnectAndPing and testMultipleClientsCanConnect), but testServerPauseCommand never completes.","status":"closed","priority":1,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T16:03:08.201924-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T16:13:13.38304-08:00","closed_at":"2026-01-20T16:13:13.38304-08:00","close_reason":"Fixed actor starvation in AtticServer main emulation loop. The loop was making rapid sequential actor calls without yielding when running behind schedule, which could starve CLI command handlers from accessing the emulator actor. Added Task.yield() in the else branch to ensure other tasks get a chance to run."}
{"id":"attic-2ni","title":"And now, for another beads task","status":"closed","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-31T21:59:23.457209-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-31T22:22:20.588083-08:00","closed_at":"2026-01-31T22:22:20.588083-08:00","close_reason":"Closed as requested"}
{"id":"attic-2u5","title":"Phase 19: Web Browser Client","description":"Full web-based emulator client running in browser with TypeScript protocol client, Canvas/WebGL rendering, Web Audio API, keyboard/touch input. Estimated effort: 3-5 days. Depends on Phase 18.","status":"open","priority":4,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:15:42.873419-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:15:42.873419-08:00","dependencies":[{"issue_id":"attic-2u5","depends_on_id":"attic-4qy","type":"blocks","created_at":"2026-01-20T12:15:47.703205-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-2u5.1","title":"Create TypeScript AESP Protocol Client","description":"TypeScript WebSocket client for AESP:\n- WebSocket connection to ws://localhost:47803\n- Binary message handling (ArrayBuffer)\n- Parse 8-byte AESP header\n- Handle FRAME_RAW (0x60) and AUDIO_PCM (0x80) messages\n- Send key events (keyDown: 0x40, keyUp: 0x41)\n- Build messages with proper header format\n\nFile: web-client/src/protocol/AESPClient.ts","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:17:19.530738-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:17:19.530738-08:00","dependencies":[{"issue_id":"attic-2u5.1","depends_on_id":"attic-2u5","type":"parent-child","created_at":"2026-01-20T12:17:19.532901-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-2u5.2","title":"Implement Canvas Video Renderer","description":"Render Atari video in browser:\n- HTML5 Canvas at 384x240 resolution\n- Convert BGRA to RGBA for putImageData\n- Target 60fps rendering\n- Optional: WebGL renderer for better performance\n\nFile: web-client/src/video/renderer.ts","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:17:25.221422-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:17:25.221422-08:00","dependencies":[{"issue_id":"attic-2u5.2","depends_on_id":"attic-2u5","type":"parent-child","created_at":"2026-01-20T12:17:25.223742-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-2u5.3","title":"Implement Web Audio Playback","description":"Audio playback using Web Audio API:\n- AudioContext at 44100Hz sample rate\n- ScriptProcessorNode for real-time audio\n- Ring buffer for sample management\n- Convert Int16 samples to Float32\n- Handle buffer underrun gracefully\n\nFile: web-client/src/audio/player.ts","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:17:31.022899-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:17:31.022899-08:00","dependencies":[{"issue_id":"attic-2u5.3","depends_on_id":"attic-2u5","type":"parent-child","created_at":"2026-01-20T12:17:31.025343-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-2u5.4","title":"Implement Browser Keyboard Handler","description":"Map browser keyboard to Atari:\n- Map KeyboardEvent.code to Atari AKEY codes\n- Handle shift and ctrl modifiers\n- Prevent default browser key actions\n- Support for special keys (Enter, Backspace, etc.)\n\nFile: web-client/src/input/keyboard.ts","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:17:36.606154-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:17:36.606154-08:00","dependencies":[{"issue_id":"attic-2u5.4","depends_on_id":"attic-2u5","type":"parent-child","created_at":"2026-01-20T12:17:36.608471-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-2u5.5","title":"Implement Web Client UI Features","description":"Web client UI elements:\n- Fullscreen toggle button\n- Mute/unmute audio button\n- Connection status indicator\n- On-screen keyboard for mobile devices\n- Touch controls for mobile joystick emulation\n- Responsive design for different screen sizes\n\nFiles: web-client/src/index.html, web-client/src/style.css, web-client/src/input/touch.ts","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:17:42.62781-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:17:42.62781-08:00","dependencies":[{"issue_id":"attic-2u5.5","depends_on_id":"attic-2u5","type":"parent-child","created_at":"2026-01-20T12:17:42.630209-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-2xm","title":"5. AESP Protocol Tests","description":"Manual testing for control channel, video channel, audio channel, and error handling","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:16.783185-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:16.783185-08:00","dependencies":[{"issue_id":"attic-2xm","depends_on_id":"attic-efy","type":"blocks","created_at":"2026-01-20T12:22:42.530249-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-2xm.1","title":"5.1 Control Channel (Port 47800)","description":"Test PING/PONG, PAUSE/ACK, RESUME/ACK, STATUS responses via netcat","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:29.001481-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:29.001481-08:00","dependencies":[{"issue_id":"attic-2xm.1","depends_on_id":"attic-2xm","type":"parent-child","created_at":"2026-01-20T12:23:29.002038-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-2xm.2","title":"5.2 Video Channel (Port 47801)","description":"Test video subscribe, receive FRAME_RAW messages, verify 368,640 byte frames, unsubscribe stops delivery","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:40.42666-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:40.42666-08:00","dependencies":[{"issue_id":"attic-2xm.2","depends_on_id":"attic-2xm","type":"parent-child","created_at":"2026-01-20T12:23:40.429088-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-2xm.3","title":"5.3 Audio Channel (Port 47802)","description":"Test audio subscribe, receive AUDIO_PCM messages, verify 16-bit PCM samples","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:40.6314-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:40.6314-08:00","dependencies":[{"issue_id":"attic-2xm.3","depends_on_id":"attic-2xm","type":"parent-child","created_at":"2026-01-20T12:23:40.632027-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-2xm.4","title":"5.4 Error Handling","description":"Test invalid magic number, invalid version, unknown message type all return ERROR","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:40.832296-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:40.832296-08:00","dependencies":[{"issue_id":"attic-2xm.4","depends_on_id":"attic-2xm","type":"parent-child","created_at":"2026-01-20T12:23:40.832889-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-2yx","title":"Implement topic-specific help in REPL Engine","description":"Returns generic 'not available'. Need to implement help text for individual commands. File: Sources/AtticCore/REPL/REPLEngine.swift:801","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:44.743714-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:44.743714-08:00","labels":["future"]}
{"id":"attic-3d1","title":"Fix BCD number encoding in BASIC tokenizer","description":"Six tests failing in BASICTokenizerTests related to BCD (Binary Coded Decimal) number encoding:\n\n**Failing tests:**\n- testBCDOne: exponent byte is 65 instead of 64, mantissa 144 instead of 16, decodes to 90.0 instead of 1.0\n- testBCDHundred: decodes to 9000.0 instead of 100.0\n- testBCDNegative: decodes to -90.0 instead of -1.0\n- testBCDPi: decodes to 94.159 instead of 3.14159\n- testBCDParsing: decodes to 9500.0 instead of 255.0\n- testBCDSmallIntOptimization: small int optimization not detecting valid cases\n\n**Root cause analysis needed:**\nThe exponent byte and mantissa encoding appear to be off by a factor. The pattern suggests the exponent is being set incorrectly (e.g., 65 vs 64 for value 1.0) and the mantissa digits are misaligned.\n\n**Files:**\n- Tests/AtticCoreTests/BASICTokenizerTests.swift (test definitions)\n- Sources/AtticCore/ (BCD encoding implementation)","status":"closed","priority":1,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T08:36:17.284091-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T15:57:09.320478-08:00","closed_at":"2026-01-20T15:57:09.320478-08:00","close_reason":"Fixed BCD encoding by normalizing mantissa to [1,10) and using pow(10,exp) instead of pow(100,exp). Also fixed floating-point precision issue in asSmallInt()."}
{"id":"attic-3j2","title":"10. BASIC Mode Tests","description":"Manual testing for line entry, program management, tokenization round-trip, and complex programs","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:26.735154-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:26.735154-08:00","dependencies":[{"issue_id":"attic-3j2","depends_on_id":"attic-0iv","type":"blocks","created_at":"2026-01-20T12:22:49.06107-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-3j2.1","title":"10.1 Line Entry","description":"Test numbered lines, tokenization, abbreviations expand, invalid syntax error","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:08.962473-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:08.962473-08:00","dependencies":[{"issue_id":"attic-3j2.1","depends_on_id":"attic-3j2","type":"parent-child","created_at":"2026-01-20T12:24:08.963068-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-3j2.2","title":"10.2 Program Management","description":"Test LIST (all and range), RUN, NEW, delete line by number","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:09.186926-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:09.186926-08:00","dependencies":[{"issue_id":"attic-3j2.2","depends_on_id":"attic-3j2","type":"parent-child","created_at":"2026-01-20T12:24:09.187582-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-3j2.3","title":"10.3 Tokenization Round-trip","description":"Test enter PRINT HELLO:GOTO 10, LIST shows identical, RUN works","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:09.403362-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:09.403362-08:00","dependencies":[{"issue_id":"attic-3j2.3","depends_on_id":"attic-3j2","type":"parent-child","created_at":"2026-01-20T12:24:09.404-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-3j2.4","title":"10.4 Complex Programs","description":"Test FOR/NEXT, IF/THEN, GOSUB/RETURN, arrays (DIM), string operations, math expressions","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:09.619409-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:09.619409-08:00","dependencies":[{"issue_id":"attic-3j2.4","depends_on_id":"attic-3j2","type":"parent-child","created_at":"2026-01-20T12:24:09.619974-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-3q0","title":"Implement Load State menu in AtticGUI","description":"Menu item has no action. Need to present NSOpenPanel filtered for .attic files. File: Sources/AtticGUI/AtticApp.swift:818","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:29.588176-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:29.588176-08:00","labels":["future"]}
{"id":"attic-3x1","title":"RUN command does not capture or return BASIC program output","description":"## Problem\n\nWhen using the `run` command in the CLI, the emulator starts executing the BASIC program but just returns \"Running\" - no program output is captured or displayed to the user. The program runs in the background with output going to the emulator screen buffer, which is not accessible from the CLI.\n\n## Current Implementation\n\n### BASICLineHandler.runProgram() (lines 501-520)\n\n```swift\npublic func runProgram() async -\u003e BASICLineResult {\n    let state = await readMemoryState()\n    \n    // Check if there is a program\n    let firstLineNum = await emulator.readWord(at: state.stmtab)\n    if firstLineNum == 0 {\n        return .error(\"No program to run\")\n    }\n    \n    // Reset STMCUR to start of program\n    await emulator.writeWord(at: BASICPointers.stmcur, value: state.stmtab)\n    \n    // Resume emulator\n    await emulator.resume()\n    \n    return .immediate(\"Running\")  // ← USER GETS NO OUTPUT!\n}\n```\n\nThe command:\n1. Sets STMCUR to the start of the program (correct)\n2. Resumes the emulator (correct)\n3. Returns \"Running\" immediately (problem!)\n\n### AtticServer handler (lines 561-567)\n\n```swift\ncase .basicRun:\n    let result = await basicHandler.runProgram()\n    if result.success {\n        return .ok(result.message)  // Just returns \"Running\"\n    } else {\n        return .error(result.message)\n    }\n```\n\n## What Is Missing\n\n1. **No screen text extraction** - The emulator only provides pixel-level frame buffers (BGRA format), not text. There is no mechanism to read the text content from the Atari display memory.\n\n2. **No execution waiting** - The command returns immediately without waiting for the program to complete.\n\n3. **No completion detection** - There is no way to detect when a BASIC program has finished executing (END statement, error, BREAK, etc.)\n\n4. **No output buffering** - Even if we could extract screen text, there is no mechanism to buffer the output as the program runs.\n\n## Implementation Options\n\n### Option A: Screen Memory Text Extraction\n\nRead Atari GRAPHICS 0 (text mode) screen RAM and decode ATASCII characters:\n- Screen RAM is at $4000-$5FFF (or pointed to by SAVMSC at $58-$59)\n- GRAPHICS 0 screen is 40 columns x 24 rows\n- Characters are ATASCII codes (need conversion to ASCII)\n- Would need to poll/sample periodically during program execution\n\n### Option B: CIO Hook/Redirection\n\nHook the Atari Central Input/Output (CIO) system to intercept PRINT output:\n- Intercept CIO calls to the screen device (E:)\n- Buffer all output characters as they are written\n- More accurate but requires deeper emulator integration\n\n### Option C: BASIC Output Vector Hook\n\nHook into BASIC interpreter output vector:\n- Monitor output through the BASIC runtime\n- May miss direct POKEs to screen memory\n\n### Option D: Hybrid Approach\n\n1. For immediate feedback: Return \"Running\" immediately (current behavior)\n2. Add a new \"output\" command that reads current screen text\n3. Add a \"wait\" command that blocks until program completes\n4. Optionally add background monitoring that sends output updates\n\n## Recommended Implementation\n\n**Phase 1 (Minimal):**\n1. Implement screen text extraction from GRAPHICS 0 memory\n2. Add to `EmulatorEngine` as `getScreenText() -\u003e String`\n3. Add new CLI command `output` or modify `run` to optionally wait and capture\n\n**Phase 2 (Enhanced):**\n1. Detect program completion (monitor STMCUR for return to immediate mode)\n2. Add timeout for long-running programs\n3. Support Ctrl+C to interrupt running programs\n\n## Files That Would Need Changes\n\n- `Sources/AtticCore/EmulatorEngine.swift` - Add screen text extraction\n- `Sources/AtticCore/BASICLineHandler.swift` - Modify `runProgram()` to optionally wait/capture\n- `Sources/AtticServer/AtticServer.swift` - Update `basicRun` handler\n- `Sources/AtticCore/CLIProtocol.swift` - May need new command types\n- `Sources/AtticCore/LibAtari800Wrapper.swift` - Low-level screen memory access\n\n## Atari Memory References\n\n- SAVMSC ($58-$59): Screen memory base address pointer\n- GRAPHICS 0 default screen: 40x24 characters = 960 bytes\n- ATASCII: Atari-specific character encoding (different from ASCII)\n- LMARGN ($52): Left margin\n- RMARGN ($53): Right margin\n- ROWCRS ($54): Current cursor row\n- COLCRS ($55-$56): Current cursor column","status":"open","priority":2,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-02T17:00:38.590472-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-02T17:02:41.716475-08:00"}
{"id":"attic-4pj","title":"Add mounted disks to status display in REPL Engine","description":"Doesn't show mounted disks. Need to add D1=..., D2=..., etc. to status output. File: Sources/AtticCore/REPL/REPLEngine.swift:869","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:44.908928-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:44.908928-08:00","labels":["future"]}
{"id":"attic-4qy","title":"Phase 18: WebSocket Bridge","description":"Enable web browser clients to connect to the emulator server via WebSocket. Translates between binary AESP protocol and WebSocket frames. Estimated effort: 2-3 days. Depends on Phase 17.","status":"open","priority":4,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:15:37.928954-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:15:37.928954-08:00","dependencies":[{"issue_id":"attic-4qy","depends_on_id":"attic-9h7","type":"blocks","created_at":"2026-01-20T12:15:47.632622-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-4qy.1","title":"Implement WebSocket Server","description":"Create WebSocket server using Network framework:\n- Create NWListener with WebSocket options on port 47803\n- Handle WebSocket handshake\n- Manage web client connections\n- Connect to AESP server as upstream client","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:16:49.429037-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:16:49.429037-08:00","dependencies":[{"issue_id":"attic-4qy.1","depends_on_id":"attic-4qy","type":"parent-child","created_at":"2026-01-20T12:16:49.43124-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-4qy.2","title":"Implement Protocol Translation","description":"Translate between AESP and WebSocket:\n- AESP binary messages pass through directly over WebSocket binary frames\n- Same 8-byte header + payload format\n- WebSocket handles framing automatically\n- No transcoding needed","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:16:55.061694-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:16:55.061694-08:00","dependencies":[{"issue_id":"attic-4qy.2","depends_on_id":"attic-4qy","type":"parent-child","created_at":"2026-01-20T12:16:55.064211-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-4qy.3","title":"Implement Video Delta Encoding for Web","description":"Optimize video streaming for web clients:\n- Delta encoding: only send changed pixels\n- Track previous frame for comparison\n- Encode changes as (index, BGRA) pairs\n- Reduce bandwidth for static scenes","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:17:00.663925-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:17:00.663925-08:00","dependencies":[{"issue_id":"attic-4qy.3","depends_on_id":"attic-4qy","type":"parent-child","created_at":"2026-01-20T12:17:00.66625-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-4qy.4","title":"Implement Audio Streaming for Web","description":"Stream audio to web clients:\n- Raw PCM samples sent as binary WebSocket messages\n- Include frame number for A/V synchronization\n- Client-side Web Audio API handles playback","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:17:06.192799-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:17:06.192799-08:00","dependencies":[{"issue_id":"attic-4qy.4","depends_on_id":"attic-4qy","type":"parent-child","created_at":"2026-01-20T12:17:06.194883-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-4qy.5","title":"Integrate WebSocket Bridge with AtticServer","description":"Integration options:\n- WebSocket bridge can run as part of AtticServer process\n- Or as separate bridge process\n- Add --websocket command-line flag to enable\n- Test with browser JavaScript console","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:17:11.911775-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:17:11.911775-08:00","dependencies":[{"issue_id":"attic-4qy.5","depends_on_id":"attic-4qy","type":"parent-child","created_at":"2026-01-20T12:17:11.914216-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-50n","title":"Add CLI-based integration tests for AtticServer","description":"Expand test coverage for AtticServer by creating automated tests that use the attic CLI to send commands. The debugging session revealed this is an effective way to verify emulator functionality. Tests should cover: memory read/write, BASIC line entry, state save/load, reset, and other CLI commands.","status":"open","priority":2,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-01T16:45:57.457537-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-01T16:45:57.457537-08:00"}
{"id":"attic-52y","title":"AtticServer still crashes on .save state - incomplete heap allocation fix","description":"CRITICAL: The previous fix (attic-zqq) was incomplete. AtticServer still crashes with SIGBUS when running '.save state \u003cfile\u003e' from CLI.\n\n**Root cause:**\nIn saveState(), even though we allocate emulator_state_t on the heap, we then call:\n```swift\nreturn EmulatorState(from: statePtr.pointee)\n```\n\nAccessing `statePtr.pointee` creates a 210KB copy on the stack to pass to the init method. This still causes stack overflow.\n\n**Required fix:**\nModify EmulatorState.init to accept UnsafePointer\u003cemulator_state_t\u003e instead of emulator_state_t value, avoiding the stack copy entirely.\n\n**Exit code:** 138 (SIGBUS)\n**Platform:** arm64 macOS 26.2","notes":"Release builds also crash. The DispatchQueue.sync only covers libatari800_get_current_state, but EmulatorState.init also runs on Task stack. Need to move entire operation to thread with larger stack.","status":"closed","priority":0,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-01T15:21:52.125586-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-01T16:13:57.893515-08:00","closed_at":"2026-02-01T16:13:57.893515-08:00","close_reason":"Fixed by dispatching saveState to main thread (8MB stack) instead of running on Swift Task stack (~512KB)"}
{"id":"attic-57b","title":"Let's try this again \u0026 again","status":"tombstone","priority":1,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-22T18:34:03.685111-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-22T21:55:35.604256-08:00","close_reason":"Closed","deleted_at":"2026-01-22T21:55:35.604256-08:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"attic-5m8","title":"Implement screenshot capture in REPL Engine","description":"Returns success without capturing. Need to call screenshot capture via GUI or embedded emulator. File: Sources/AtticCore/REPL/REPLEngine.swift:158","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:29.910459-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:29.910459-08:00","labels":["future"]}
{"id":"attic-5xn","title":"Implement cross-drive file copy in REPL Engine","description":"Marked as placeholder. Need to implement copying files between different mounted drives. File: Sources/AtticCore/REPL/REPLEngine.swift:609","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:44.415209-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:44.415209-08:00","labels":["future"]}
{"id":"attic-69h","title":"12. Performance Tests","description":"Manual testing for frame rate, audio latency, and memory usage","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:27.062305-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:27.062305-08:00","dependencies":[{"issue_id":"attic-69h","depends_on_id":"attic-z1v","type":"blocks","created_at":"2026-01-20T12:22:49.38072-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-69h.1","title":"12.1 Frame Rate","description":"Test GUI maintains 60fps, no frame drops, status bar shows consistent rate","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:24.612483-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:24.612483-08:00","dependencies":[{"issue_id":"attic-69h.1","depends_on_id":"attic-69h","type":"parent-child","created_at":"2026-01-20T12:24:24.613089-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-69h.2","title":"12.2 Audio Latency","description":"Test keyclick responds within ~50ms, no buffer underruns, audio stays in sync","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:24.841411-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:24.841411-08:00","dependencies":[{"issue_id":"attic-69h.2","depends_on_id":"attic-69h","type":"parent-child","created_at":"2026-01-20T12:24:24.842044-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-69h.3","title":"12.3 Memory Usage","description":"Test stable memory over time, no leaks during extended sessions, no spikes on large disk ops","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:25.075038-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:25.075038-08:00","dependencies":[{"issue_id":"attic-69h.3","depends_on_id":"attic-69h","type":"parent-child","created_at":"2026-01-20T12:24:25.075754-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-6kf","title":"Add Game Controller Support","description":"Add support for game controllers via GameController framework. Includes D-pad/analog mapping to joystick, button mapping, connect/disconnect handling, and multi-controller support for ports 1-4. Files: Sources/AtticCore/Input/GameControllerHandler.swift (new), Sources/AtticGUI/AtticApp.swift","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:15.911377-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:15.911377-08:00","labels":["future"]}
{"id":"attic-7mg","title":"Implement screenshot capture in AtticServer","description":"Screenshot command accepted but not implemented. Need to capture frame buffer and save as PNG file. File: Sources/AtticServer/main.swift:467","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:16.218539-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:16.218539-08:00","labels":["future"]}
{"id":"attic-7pt","title":"Ensure that the directory structure documented for AtticCore still matches what is actually there","status":"closed","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T07:56:51.277796-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T08:54:47.219326-08:00","closed_at":"2026-01-20T08:54:47.219326-08:00","close_reason":"Updated ARCHITECTURE.md component diagram to reflect actual flat file structure with all 38 AtticCore files"}
{"id":"attic-8ox","title":"Implement window scaling in AtticGUI","description":"Three menu items (1x, 2x, 3x) have no action. Need to resize window to 384×240 multiplied by scale factor. File: Sources/AtticGUI/AtticApp.swift:860-872","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:29.747482-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:29.747482-08:00","labels":["future"]}
{"id":"attic-8qi","title":"Replace direct memory injection with keyboard injection for BASIC line entry","description":"## Problem\n\nThe current approach of writing tokenized BASIC code directly into emulator memory (attic-0vu) is fundamentally flawed. Memory layout changes when variables are introduced, string storage moves, and the BASIC interpreter's internal state becomes desynchronized.\n\n## Proposed Solution: Keyboard Injection\n\nSimulate keystrokes as if the user typed the BASIC code. The emulator's built-in BASIC interpreter handles tokenization naturally.\n\n**Pros:**\n- Uses the real BASIC interpreter - guaranteed correct behavior\n- No memory layout synchronization issues\n- Handles all edge cases (variables, strings, line renumbering)\n\n**Cons:**\n- Slower than direct memory writes (~50-100ms per line)\n- Need to handle timing (wait for interpreter ready)\n\n## Investigation Findings\n\n### Existing Infrastructure\n\n**Single key injection already works:**\n```swift\n// EmulatorEngine.swift:413-420\npublic func pressKey(keyChar: UInt8, keyCode: UInt8, shift: Bool = false, control: Bool = false)\npublic func releaseKey()\n```\n\n**AESP protocol supports keyboard:**\n- `keyDown` (0x40) - Key press with modifiers\n- `keyUp` (0x41) - Release current key\n- Messages defined in AESPMessage.swift:534-549\n\n**Key latching mechanism exists** (EmulatorEngine.swift:106-110):\n- Keys held for at least one frame before release\n- Prevents missed keystrokes\n\n### What's Missing\n\n1. **No keyboard queue/buffer** - Only one key active at a time\n2. **No string injection API** - No method to send \"10 PRINT HELLO\" as a string\n3. **No timing management** - Must manually wait between keystrokes\n\n## Implementation Plan\n\n### Phase 1: Core String Injection\n\nAdd to EmulatorEngine.swift:\n```swift\n/// Injects a string of characters as keyboard input\n/// - Parameter text: The text to inject (e.g., \"10 PRINT HELLO\")\n/// - Parameter delayMs: Milliseconds between keystrokes (default 50)\npublic func injectString(_ text: String, delayMs: Int = 50) async {\n    for char in text {\n        let (keyChar, keyCode, shift, control) = mapCharToAtariKey(char)\n        await pressKey(keyChar: keyChar, keyCode: keyCode, shift: shift, control: control)\n        try? await Task.sleep(nanoseconds: UInt64(delayMs) * 1_000_000)\n        await releaseKey()\n        try? await Task.sleep(nanoseconds: UInt64(delayMs) * 1_000_000)\n    }\n}\n```\n\n### Phase 2: BASIC Line Injection\n\nAdd to REPLEngine or BASICLineHandler:\n```swift\n/// Injects a BASIC line via keyboard simulation\n/// - Parameter line: The BASIC line (e.g., \"10 PRINT HELLO\")\npublic func injectBASICLine(_ line: String) async throws {\n    // 1. Inject the line text\n    await emulator.injectString(line)\n    // 2. Press RETURN to enter the line\n    await emulator.pressKey(keyChar: 0, keyCode: AKEY_RETURN)\n    await emulator.releaseKey()\n    // 3. Wait for BASIC to process (check for READY prompt)\n    try await waitForBASICReady()\n}\n```\n\n### Phase 3: AESP Protocol Extension\n\nAdd new message type for string injection:\n- `injectString` (0x44) - Inject string as keyboard input\n- Payload: UTF-8 string bytes\n\n### Phase 4: Remove Old Memory Injection\n\nOnce keyboard injection is working:\n1. Remove BASICLineHandler memory injection code\n2. Remove related memory address calculations\n3. Close attic-0vu as superseded\n\n## Key Files\n\n| File | Changes Needed |\n|------|----------------|\n| Sources/AtticCore/EmulatorEngine.swift | Add injectString(), mapCharToAtariKey() |\n| Sources/AtticCore/KeyboardInputHandler.swift | Reference for key mapping constants |\n| Sources/AtticCore/REPLEngine.swift | Update BASIC line handling to use injection |\n| Sources/AtticProtocol/AESPMessage.swift | Add injectString message type |\n| Sources/AtticProtocol/AESPClient.swift | Add sendInjectString() method |\n\n## Testing\n\n1. Single character injection (A-Z, 0-9, symbols)\n2. Full BASIC line: `10 PRINT \"HELLO WORLD\"`\n3. Multi-line program injection\n4. Special characters and control codes\n5. Timing verification (no missed keystrokes)\n\n## Success Criteria\n\n- BASIC lines entered via CLI appear correctly in emulator\n- Variables work correctly when lines reference them\n- RUN command executes injected programs\n- No memory corruption or desynchronization","status":"open","priority":1,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-03T09:53:38.835412-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-03T10:42:31.767622-08:00","dependencies":[{"issue_id":"attic-8qi","depends_on_id":"attic-ahr","type":"blocks","created_at":"2026-02-03T10:42:31.832976-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-90d","title":"Add disk format confirmation in REPL Engine","description":"No user confirmation dialog. Need to add confirmation prompt before destructive format operation. File: Sources/AtticCore/REPL/REPLEngine.swift:724","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:44.581125-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:44.581125-08:00","labels":["future"]}
{"id":"attic-91j","title":"Implement Go command with PC setting in AtticCLI","description":"Currently translates to 'resume' without setting PC. Need to parse address argument and set PC before resume. File: Sources/AtticCLI/main.swift:405","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:16.72476-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:16.72476-08:00","labels":["future"]}
{"id":"attic-99j","title":".reset command does not clear BASIC memory","description":"When issuing the .reset command through the attic CLI, the BASIC program memory is not cleared. The reset should return the emulator to a clean BASIC READY state with no program in memory.","status":"closed","priority":2,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-01T16:08:16.253692-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-01T19:50:42.384826-08:00","closed_at":"2026-02-01T19:50:42.384826-08:00","close_reason":"Fixed .reset command to properly clear BASIC memory. The fix uses RAMTOP ($6A) instead of BASIC's MEMTOP ($90-91) to calculate the correct memory bounds, since MEMTOP was not properly initialized after reboot. Also now writes MEMTOP to $90-91 so BASIC can use proper memory limits."}
{"id":"attic-9h7","title":"Phase 17: Polish \u0026 Integration","description":"Production-ready native application with complete menu implementation, file dialogs, preferences, screenshot capture, Emacs integration, and app bundle polish. Estimated effort: 3-5 days.","status":"open","priority":3,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:15:32.737414-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:15:32.737414-08:00"}
{"id":"attic-9h7.1","title":"Implement Menu Bar actions","description":"Implement all menu item actions:\n- File menu: Open Disk, Save/Load State, Screenshot\n- Emulator menu: Run, Pause, Reset, Drive submenus\n- View menu: Window scaling (1x, 2x, 3x), Full Screen\n- Add keyboard shortcuts for all actions\n- Implement Recent Files submenu\n\nFiles: Sources/AtticGUI/AtticApp.swift:806-872","status":"open","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:15:57.128102-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:15:57.128102-08:00","dependencies":[{"issue_id":"attic-9h7.1","depends_on_id":"attic-9h7","type":"parent-child","created_at":"2026-01-20T12:15:57.130766-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9h7.2","title":"Implement File Dialogs","description":"Implement NSOpenPanel and NSSavePanel for:\n- Open disk image (.atr files)\n- Save state (.attic files)\n- Load state (.attic files)\n- Handle double-click file open\n\nFiles: Sources/AtticGUI/AtticApp.swift:158, 806, 813, 818","status":"open","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:16:03.504776-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:16:03.504776-08:00","dependencies":[{"issue_id":"attic-9h7.2","depends_on_id":"attic-9h7","type":"parent-child","created_at":"2026-01-20T12:16:03.508537-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9h7.3","title":"Implement Screenshot capture","description":"Capture Metal texture content and save as PNG:\n- Capture frame buffer from emulator\n- Convert to PNG using Core Graphics\n- Save to user-specified or default path\n- Integrate with REPL screenshot command\n\nFiles: Sources/AtticServer/main.swift:467, Sources/AtticCore/REPL/REPLEngine.swift:158","status":"open","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:16:09.945553-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:16:09.945553-08:00","dependencies":[{"issue_id":"attic-9h7.3","depends_on_id":"attic-9h7","type":"parent-child","created_at":"2026-01-20T12:16:09.947942-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9h7.4","title":"Implement Preferences Window","description":"Create preferences window with:\n- ROM path configuration\n- Audio settings (volume, enable/disable)\n- Video settings (scaling mode, scanlines)\n- Key binding customization\n- Persist settings using UserDefaults or JSON file","status":"open","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:16:15.455042-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:16:15.455042-08:00","dependencies":[{"issue_id":"attic-9h7.4","depends_on_id":"attic-9h7","type":"parent-child","created_at":"2026-01-20T12:16:15.45802-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9h7.5","title":"Implement Recent Files tracking","description":"Track recently opened files:\n- Store recently opened disk images and state files\n- Persist in UserDefaults\n- Display in File \u003e Recent submenu\n- Clear recent items option","status":"open","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:16:20.825496-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:16:20.825496-08:00","dependencies":[{"issue_id":"attic-9h7.5","depends_on_id":"attic-9h7","type":"parent-child","created_at":"2026-01-20T12:16:20.82786-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9h7.6","title":"Polish Error Handling","description":"Improve error handling UX:\n- User-friendly error dialogs for common issues\n- Suggestions for resolution\n- Log file for debugging","status":"open","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:16:25.887972-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:16:25.887972-08:00","dependencies":[{"issue_id":"attic-9h7.6","depends_on_id":"attic-9h7","type":"parent-child","created_at":"2026-01-20T12:16:25.890336-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9h7.7","title":"Create Emacs attic-mode.el","description":"Create Emacs major mode for Attic REPL:\n- Derive from comint-mode\n- Configure prompt regexp for comint\n- Key bindings: C-c C-r (run), C-c C-p (pause), C-c C-s (step)\n- Interactive function to start REPL","status":"open","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:16:32.009671-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:16:32.009671-08:00","dependencies":[{"issue_id":"attic-9h7.7","depends_on_id":"attic-9h7","type":"parent-child","created_at":"2026-01-20T12:16:32.011805-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9h7.8","title":"Write User Documentation","description":"Create user documentation:\n- User guide with screenshots\n- Command reference\n- Troubleshooting guide","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:16:36.708621-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:16:36.708621-08:00","dependencies":[{"issue_id":"attic-9h7.8","depends_on_id":"attic-9h7","type":"parent-child","created_at":"2026-01-20T12:16:36.711203-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9h7.9","title":"Polish App Bundle for distribution","description":"Prepare application for distribution:\n- Application icon (multiple resolutions)\n- Complete Info.plist with UTI declarations\n- Code signing for distribution\n- DMG installer creation","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:16:42.494333-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:16:42.494333-08:00","dependencies":[{"issue_id":"attic-9h7.9","depends_on_id":"attic-9h7","type":"parent-child","created_at":"2026-01-20T12:16:42.496703-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9w2","title":"2. AtticGUI Tests","description":"Manual testing for AtticGUI client mode, embedded mode, and window controls","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:16.327571-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:16.327571-08:00","dependencies":[{"issue_id":"attic-9w2","depends_on_id":"attic-08d","type":"blocks","created_at":"2026-01-20T12:22:42.064607-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9w2.1","title":"2.1 Client Mode (Default)","description":"Test GUI connection, video display (384x240, 60fps, NTSC palette), audio (boot sound, keyclick, no crackling)","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:14.904304-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:14.904304-08:00","dependencies":[{"issue_id":"attic-9w2.1","depends_on_id":"attic-9w2","type":"parent-child","created_at":"2026-01-20T12:23:14.904972-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9w2.2","title":"2.2 Embedded Mode","description":"Test --embedded flag starts successfully, emulator runs directly, video and audio work","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:15.098133-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:15.098133-08:00","dependencies":[{"issue_id":"attic-9w2.2","depends_on_id":"attic-9w2","type":"parent-child","created_at":"2026-01-20T12:23:15.098895-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-9w2.3","title":"2.3 Window Controls","description":"Test window resize, close button, minimize","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:15.294373-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:15.294373-08:00","dependencies":[{"issue_id":"attic-9w2.3","depends_on_id":"attic-9w2","type":"parent-child","created_at":"2026-01-20T12:23:15.294963-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-a47","title":"Implement breakpoint write tracking in Monitor Controller","description":"Writing to breakpoint address doesn't update tracked byte. Need to update original byte tracking when writing to breakpointed address. File: Sources/AtticCore/Monitor/MonitorController.swift:245","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:45.0771-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:45.0771-08:00","labels":["future"]}
{"id":"attic-ahr","title":"Keyboard injection not working - libatari800 doesn't detect key presses","description":"The keyboard injection approach (attic-8qi) is not working. Keys are correctly passed to libatari800 via input_template_t, but the Atari's keyboard buffer (CH at $02FC) always shows 0xFF (no key detected).\n\nSymptoms:\n- injectString() runs and passes keyCode values to wrapper.executeFrame()\n- Frame execution completes successfully (396 frames for a short line)\n- But CH register never changes from 0xFF\n- Screen never shows the typed characters\n- BASIC program area remains empty\n\nAttempted solutions:\n1. Using ATASCII in keychar with keycode=0xFF (like GUI does)\n2. Using internal key codes in keycode field\n3. Adding usleep delays between frames\n4. Increasing frames per character and wait times\n\nThe GUI keyboard input works correctly, so there's something different about how input is processed in the GUI's continuous runLoop vs our programmatic frame execution.\n\nThis blocks attic-8qi. Further investigation needed into libatari800's keyboard polling mechanism.","status":"open","priority":1,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-03T10:42:21.135142-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-03T10:42:21.135142-08:00"}
{"id":"attic-apy","title":"14. Multi-Client Tests","description":"Manual testing for multiple GUI clients and CLI with GUI together","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:27.374775-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:27.374775-08:00","dependencies":[{"issue_id":"attic-apy","depends_on_id":"attic-upp","type":"blocks","created_at":"2026-01-20T12:22:49.701561-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-apy.1","title":"14.1 Multiple GUI Clients","description":"Test two GUI clients both receive video/audio frames, input from either works","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:32.389861-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:32.389861-08:00","dependencies":[{"issue_id":"attic-apy.1","depends_on_id":"attic-apy","type":"parent-child","created_at":"2026-01-20T12:24:32.390509-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-apy.2","title":"14.2 CLI and GUI Together","description":"Test CLI commands affect GUI display, both can pause/resume","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:32.618752-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:32.618752-08:00","dependencies":[{"issue_id":"attic-apy.2","depends_on_id":"attic-apy","type":"parent-child","created_at":"2026-01-20T12:24:32.619432-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-bcb","title":"Xcode project build shows errors","description":"Xcode build fails with 10 errors in EmulatorEngine.swift (lines 600-654). Missing types related to state save/load:\n\n- StateMetadata (lines 600, 631, 651)\n- StateFileFlags (line 604)\n- StateFileHandler (lines 610, 633)\n- StateFileError (lines 611, 636, 654)\n\nAlso missing member reference:\n- .wasPaused (line 606)\n\nThese types appear to be referenced but not defined in the codebase.","notes":"Root cause: A stale Attic.xcodeproj file (from Jan 16) was taking precedence over Package.swift. xcodebuild prefers .xcodeproj files over Swift packages.\n\nFix applied:\n1. Removed stale Attic.xcodeproj\n2. Flattened AtticCore directory structure (moved all .swift files from subdirectories to Sources/AtticCore/ root) to work around Xcode 26 bug with subdirectory discovery\n3. Updated Package.swift comments\n\nBoth swift build and xcodebuild now succeed.","status":"closed","priority":0,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-19T21:22:03.57739-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-19T21:44:43.559248-08:00","closed_at":"2026-01-19T21:44:43.559248-08:00","close_reason":"Fixed by removing stale Attic.xcodeproj and flattening AtticCore directory structure. Both swift build and xcodebuild now succeed."}
{"id":"attic-blj","title":"Remove unused variable declarations","description":"Swift compiler warnings about unused immutable values:\n- MonitorStepper.swift:302 - 'result' was never used\n- AtticServer.swift:488 - 'address' was never used\n\nReplace with '_' or remove the declarations entirely.","status":"open","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T08:44:46.911936-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T08:44:46.911936-08:00"}
{"id":"attic-bvw","title":"BASIC memory not initialized correctly on fresh server start","description":"## Problem\n\nWhen entering BASIC lines immediately after connecting to AtticServer, you get an \"Out of memory\" error even for simple one-line programs like `10 REM HELLO`.\n\n## Root Cause\n\nIn `AtticServer.swift` lines 702-763, the startup sequence is:\n\n```swift\n// Line 706\ntry await emulator.initialize(romPath: romPath)\n// ...server setup...\n// Line 763\nawait emulator.resume()\n```\n\n**The problem:** `initialize()` only calls `libatari800_init()` which loads ROMs but does NOT run the Atari boot sequence. The boot sequence is what initializes BASIC memory pointers.\n\nWithout running the boot sequence:\n- MEMTOP ($90-$91) is set to garbage/default value like $0804\n- RUNSTK ($8E-$8F) is also uninitialized\n- The memory check `newStarp \u003e Int(state.runstk) - 256` fails immediately\n\n## The Fix Is Simple\n\nIn `AtticServer.swift`, after `initialize()`, add a cold reset:\n\n```swift\ntry await emulator.initialize(romPath: romPath)\nawait emulator.reset(cold: true)  // \u003c-- ADD THIS LINE\nprint(\"Emulator initialized successfully\")\n```\n\nThe `reset(cold: true)` method already:\n1. Calls `wrapper.reboot(with: nil)` to trigger boot\n2. Runs 150 frames to complete boot sequence (~2.5 seconds worth)\n3. Calls `clearBASICProgram()` which reads RAMTOP ($6A) and properly initializes all BASIC pointers\n\n## Why .reset Command Works As Workaround\n\nWhen you run `.reset` in the CLI, it triggers `reset(cold: true)` which properly initializes BASIC memory. That is why BASIC lines work after a reset.\n\n## Memory Pointer Details\n\nThe `clearBASICProgram()` function in `EmulatorEngine.swift:224-254` properly initializes:\n- VNTP ($82-$83): Variable Name Table Pointer\n- VNTD ($84-$85): Variable Name Table Dummy End  \n- VVTP ($86-$87): Variable Value Table Pointer\n- STMTAB ($88-$89): Statement Table\n- STMCUR ($8A-$8B): Current Statement Pointer\n- STARP ($8C-$8D): String/Array Table Pointer\n- RUNSTK ($8E-$8F): Runtime Stack Pointer (set to MEMTOP)\n- MEMTOP ($90-$91): Top of BASIC memory\n\nIt reads RAMTOP ($6A) which IS correctly set by libatari800, then uses that to calculate proper BASIC memory layout.\n\n## Files to Modify\n\n- `Sources/AtticServer/AtticServer.swift` line ~706: Add `await emulator.reset(cold: true)` after initialize\n\n## Alternative Fix Location\n\nCould also modify `EmulatorEngine.initialize()` to automatically run boot sequence and initialize BASIC memory, but that would change behavior for all clients (GUI might want to handle boot differently).","status":"closed","priority":2,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-01T19:50:52.04036-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-02T17:29:41.224661-08:00","closed_at":"2026-02-02T17:29:41.224661-08:00","close_reason":"Added cold reset after emulator.initialize() in AtticServer.swift to run boot sequence and initialize BASIC memory pointers"}
{"id":"attic-c4f","title":"Rename AtticServer/main.swift to AtticServer.swift for @main compatibility","description":"AtticServer has @main attribute on line 669 but the file is named main.swift. Swift does not allow @main in files named main.swift because that filename implies top-level executable code.\n\nFix: Rename Sources/AtticServer/main.swift to Sources/AtticServer/AtticServer.swift\n\nVerification:\n1. swift build succeeds\n2. xcodebuild succeeds (if attic-npk is addressed)","status":"closed","priority":1,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T08:03:44.487409-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T08:07:41.777875-08:00","closed_at":"2026-01-20T08:07:41.777875-08:00","close_reason":"Renamed main.swift to AtticServer.swift. swift build verified successful."}
{"id":"attic-ced","title":"swift test hangs on testMultipleClientsCanConnect","description":"When running swift test, the test suite hangs indefinitely on AtticServerSubprocessTests.testMultipleClientsCanConnect.\n\n## Symptoms\n- All previous tests pass (168 tests)\n- Test suite freezes after 'testClientCanConnectAndPing' completes\n- The test 'testMultipleClientsCanConnect' starts but never finishes\n\n## Root Cause Analysis\nThe test creates two CLISocketClient actors and connects them sequentially to the same server:\n```swift\ntry await client1.connect(to: socketPath)\ntry await client2.connect(to: socketPath)\n```\n\nThe likely causes are:\n1. **Actor concurrency issue**: Both CLISocketClient and CLISocketServer are actors using detached tasks with blocking I/O (select() calls)\n2. **Timing race**: The server's acceptLoop or clientReadLoop may not yield quickly enough to handle the second connection\n3. **Ping verification deadlock**: Each connect() sends a ping and waits for pong - the second client's ping response may never arrive\n\n## Relevant Files\n- Tests/AtticCoreTests/CLISubprocessTests.swift:485-549 (the hanging test)\n- Sources/AtticCore/CLISocketClient.swift (client implementation)\n- Sources/AtticCore/CLISocketServer.swift (server implementation)\n\n## Suggested Fixes\n1. Add explicit timeout handling to connect() to fail fast instead of hanging\n2. Review actor isolation and Task.yield() placement in both client and server\n3. Consider using non-blocking I/O or async I/O patterns instead of select()\n4. Add diagnostic logging to identify where exactly the hang occurs","status":"closed","priority":1,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:19:18.666235-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:42:27.222737-08:00","closed_at":"2026-01-20T09:42:27.222737-08:00","close_reason":"Fixed by using shorter pingTimeout (1s) instead of commandTimeout (30s) for connection verification, using detached timeout tasks for reliability, and adding multiple yields to give event reader time to start. Test now passes in ~2 seconds."}
{"id":"attic-cj9","title":"Why is it not syncing","status":"closed","priority":0,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-22T17:49:22.793046-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-31T21:48:30.394083-08:00","closed_at":"2026-01-31T21:48:30.394083-08:00","close_reason":"Closed"}
{"id":"attic-cp1","title":"3. Keyboard Input Tests","description":"Manual testing for basic keys, special keys, modifier keys, and on-screen console buttons","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:16.479104-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:16.479104-08:00","dependencies":[{"issue_id":"attic-cp1","depends_on_id":"attic-9w2","type":"blocks","created_at":"2026-01-20T12:22:42.225681-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-cp1.1","title":"3.1 Basic Keys","description":"Test A-Z, 0-9, space, return, backspace, tab keys","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:15.480022-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:15.480022-08:00","dependencies":[{"issue_id":"attic-cp1.1","depends_on_id":"attic-cp1","type":"parent-child","created_at":"2026-01-20T12:23:15.480569-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-cp1.2","title":"3.2 Special Keys","description":"Test F1 (START), F2 (SELECT), F3 (OPTION), backtick (ATARI), Escape, Caps Lock","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:27.838453-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:27.838453-08:00","dependencies":[{"issue_id":"attic-cp1.2","depends_on_id":"attic-cp1","type":"parent-child","created_at":"2026-01-20T12:23:27.84084-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-cp1.3","title":"3.3 Modifier Keys","description":"Test Shift, Control modifier (Ctrl+A inverse), arrow keys","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:28.044672-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:28.044672-08:00","dependencies":[{"issue_id":"attic-cp1.3","depends_on_id":"attic-cp1","type":"parent-child","created_at":"2026-01-20T12:23:28.045328-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-cp1.4","title":"3.4 On-Screen Console Buttons","description":"Test START, SELECT, OPTION buttons clickable and highlight on F-key press","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:28.238972-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:28.238972-08:00","dependencies":[{"issue_id":"attic-cp1.4","depends_on_id":"attic-cp1","type":"parent-child","created_at":"2026-01-20T12:23:28.239581-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-cwk","title":"Low priority beads","status":"tombstone","priority":4,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-22T18:50:45.9371-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-22T19:47:41.586945-08:00","close_reason":"Closed","deleted_at":"2026-01-22T19:47:41.586945-08:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"attic-cxd","title":"Implement drives command in AtticServer","description":"Drives command stub currently returns 'drives (none)'. Need to query DiskManager for actually mounted drives. File: Sources/AtticServer/main.swift:432","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:16.070187-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:16.070187-08:00","labels":["future"]}
{"id":"attic-d6l","title":"8. Monitor/Debugger Tests","description":"Manual testing for breakpoints, stepping, and assembler","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:26.404929-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:26.404929-08:00","dependencies":[{"issue_id":"attic-d6l","depends_on_id":"attic-yz4","type":"blocks","created_at":"2026-01-20T12:22:42.992278-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-d6l.1","title":"8.1 Breakpoints","description":"Test set breakpoint at RAM, run to breakpoint, emulator pauses, hit message shows address/registers, clear works","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:55.365344-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:55.365344-08:00","dependencies":[{"issue_id":"attic-d6l.1","depends_on_id":"attic-d6l","type":"parent-child","created_at":"2026-01-20T12:23:55.365926-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-d6l.2","title":"8.2 Stepping","description":"Test single step (s), step count (s 10), step over JSR (so), until address (until $XXXX)","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:55.574732-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:55.574732-08:00","dependencies":[{"issue_id":"attic-d6l.2","depends_on_id":"attic-d6l","type":"parent-child","created_at":"2026-01-20T12:23:55.575343-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-d6l.3","title":"8.3 Assembler","description":"Test a $0600 enters assembly mode, instructions assemble, labels work, forward references resolve, END exits, assembled code executes","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:55.789941-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:55.789941-08:00","dependencies":[{"issue_id":"attic-d6l.3","depends_on_id":"attic-d6l","type":"parent-child","created_at":"2026-01-20T12:23:55.790551-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-dat","title":"Implement Save State menu in AtticGUI","description":"Menu item has no action. Need to present NSSavePanel and call state persistence. File: Sources/AtticGUI/AtticApp.swift:813","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:29.425245-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:29.425245-08:00","labels":["future"]}
{"id":"attic-e0u","title":"Fix DATA section alignment warning in libatari800","description":"Xcode linker warning: 'reducing alignment of section __DATA,__common from 0x8000 to 0x4000 because it exceeds segment maximum alignment'. This occurs when linking libatari800.a. May need to rebuild libatari800 with appropriate alignment flags or adjust linker settings.","status":"open","priority":3,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T08:41:01.818316-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T08:41:01.818316-08:00"}
{"id":"attic-e2m","title":"Implement breakpoint event register parsing in CLI Protocol","description":"Only extracts address, returns zero registers. Need to parse A, X, Y, S, P values from breakpoint event data. File: Sources/AtticCore/CLI/CLIProtocol.swift:815","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:45.239144-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:45.239144-08:00","labels":["future"]}
{"id":"attic-e4y","title":"Implement BASIC injection in AtticServer","description":"Currently validates base64 but doesn't inject. Need to use BASICMemoryLayout to inject tokenized BASIC into emulator memory. File: Sources/AtticServer/main.swift:473","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:16.407317-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:16.407317-08:00","labels":["future"]}
{"id":"attic-eam","title":"Fix macOS deployment target mismatch warnings for libatari800","description":"Xcode shows 70+ linker warnings: 'object file was built for newer macOS version (26.0) than being linked (15.0)'. The libatari800.a static library was compiled targeting macOS 26.0 but Package.swift targets macOS 15.0. Options: (1) Rebuild libatari800 with -mmacosx-version-min=15.0, (2) Update project deployment target to macOS 26.0, or (3) Suppress warnings if mismatch is intentional.","status":"closed","priority":2,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T08:41:01.645073-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-01T21:27:35.939544-08:00","closed_at":"2026-02-01T12:27:07.23435-08:00"}
{"id":"attic-efy","title":"4. CLI Tests","description":"Manual testing for CLI connection, headless mode, and REPL commands","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:16.633995-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:16.633995-08:00","dependencies":[{"issue_id":"attic-efy","depends_on_id":"attic-cp1","type":"blocks","created_at":"2026-01-20T12:22:42.375472-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-efy.1","title":"4.1 Connection","description":"Test CLI finds running server, auto-launches if not running, --socket flag, welcome banner","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:28.431979-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:28.431979-08:00","dependencies":[{"issue_id":"attic-efy.1","depends_on_id":"attic-efy","type":"parent-child","created_at":"2026-01-20T12:23:28.43263-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-efy.2","title":"4.2 Headless Mode","description":"Test --headless launches server, --headless --silent has no audio, REPL prompt appears","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:28.626134-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:28.626134-08:00","dependencies":[{"issue_id":"attic-efy.2","depends_on_id":"attic-efy","type":"parent-child","created_at":"2026-01-20T12:23:28.626746-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-efy.3","title":"4.3 REPL Commands","description":"Test Basic Mode (PRINT, LIST, RUN, NEW, .monitor, .dos), Monitor Mode (r, m, d, bp, bl, bc, s, g, .basic), DOS Mode (mount, dir, type, dump, info, unmount, .basic)","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:28.813153-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:28.813153-08:00","dependencies":[{"issue_id":"attic-efy.3","depends_on_id":"attic-efy","type":"parent-child","created_at":"2026-01-20T12:23:28.813739-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-ek7","title":"Audit all executables for @main in main.swift conflict","description":"Check all executable targets in the project for the Swift @main attribute conflict.\n\nSwift does not allow @main attribute in files named main.swift because that filename implies top-level executable code.\n\nExecutables to check:\n- AtticServer (Sources/AtticServer/main.swift) - KNOWN ISSUE\n- AtticCLI (Sources/AtticCLI/) - FIXED (renamed to AtticCLI.swift)\n- AtticGUI (Sources/AtticGUI/)\n\nFor each executable with a main.swift file using @main:\n1. Rename main.swift to match the module name (e.g., AtticServer.swift)\n2. Verify build succeeds with both swift build and xcodebuild\n\nRelated: attic-npk (Xcode build errors)","status":"closed","priority":1,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T07:55:23.315337-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T08:03:54.353609-08:00","closed_at":"2026-01-20T08:03:54.353609-08:00","close_reason":"Audit complete. Found 1 issue: AtticServer/main.swift needs rename. Created attic-c4f to track the fix. AtticCLI and AtticGUI are already correct."}
{"id":"attic-flz","title":"Implement BASIC LOAD/SAVE from ATR disk images","description":"## Overview\n\nImplement disk-based BASIC program loading and saving. This provides an alternative to keyboard injection for loading entire programs at once, using the standard Atari workflow.\n\n## Investigation Findings\n\n### ATR Infrastructure is 95% Complete\n\nThe project already has comprehensive ATR disk support:\n\n| Feature | Status | Location |\n|---------|--------|----------|\n| ATR Container Format | ✅ Complete | ATRImage.swift |\n| DOS 2.x Filesystem | ✅ Complete | ATRFileSystem.swift |\n| File Read/Write | ✅ Complete | ATRFileSystem.swift |\n| Disk Mount Management | ✅ Complete | DiskManager.swift |\n| libatari800 SIO Binding | ✅ Complete | LibAtari800Wrapper.swift |\n| REPL DOS Commands | ✅ Complete | REPLEngine.swift |\n| BASIC Import (from host) | ✅ Complete | REPLEngine.executeBasicImport() |\n| BASIC Export (to host) | ✅ Complete | REPLEngine.executeBasicExport() |\n| **BASIC LOAD from disk** | ⏳ Stub only | REPLEngine.basicLoadATR() |\n| **BASIC SAVE to disk** | ⏳ Stub only | REPLEngine.basicSaveATR() |\n\n### Current Stub (REPLEngine.swift)\n\n```swift\ncase .basicLoadATR(let filename):\n    return \"LOAD \\\"\\(filename)\\\" [requires ATR filesystem - Phase 12]\"\n```\n\n### Key Files\n\n- `Sources/AtticCore/ATRImage.swift` - Container format (627 lines)\n- `Sources/AtticCore/ATRFileSystem.swift` - File operations (1,013 lines)\n- `Sources/AtticCore/DiskManager.swift` - Mount management (743 lines)\n- `Sources/AtticCore/REPLEngine.swift` - Command dispatch\n- `docs/ATR_FILESYSTEM.md` - Complete specification\n\n## Implementation Plan\n\n### Task 1: LOAD Command Handler\n\nUpdate REPLEngine.swift:\n\n```swift\ncase .basicLoadATR(let filename):\n    // 1. Parse \"D:FILENAME.BAS\" format\n    let (drive, name) = parseAtariFilename(filename)\n    \n    // 2. Read file from mounted disk\n    guard let disk = await diskManager.getDisk(drive: drive) else {\n        throw REPLError.driveNotMounted(drive)\n    }\n    let fs = try ATRFileSystem(disk: disk)\n    let data = try fs.readFile(name)\n    \n    // 3. Tokenize the BASIC text (if source file)\n    // Or inject raw tokenized data (if .BAS binary)\n    let tokenized = try BASICTokenizer.tokenize(String(data: data, encoding: .utf8)!)\n    \n    // 4. Inject into emulator memory\n    try await emulator.injectBASICProgram(tokenized)\n    \n    return \"Program loaded: \\(data.count) bytes\"\n```\n\n### Task 2: SAVE Command Handler\n\n```swift\ncase .basicSaveATR(let filename):\n    // 1. Parse filename\n    let (drive, name) = parseAtariFilename(filename)\n    \n    // 2. Extract program from emulator memory\n    let tokenized = try await emulator.extractBASICProgram()\n    \n    // 3. Optionally detokenize to source\n    let source = try BASICDetokenizer.detokenize(tokenized)\n    \n    // 4. Write to disk\n    guard let disk = await diskManager.getDisk(drive: drive) else {\n        throw REPLError.driveNotMounted(drive)\n    }\n    let fs = try ATRFileSystem(disk: disk)\n    try fs.writeFile(name, data: source.data(using: .utf8)!)\n    \n    return \"Program saved: \\(name)\"\n```\n\n### Task 3: Filename Parsing\n\n```swift\nfunc parseAtariFilename(_ filename: String) -\u003e (drive: Int, name: String) {\n    // Handle: \"D:FILE.BAS\", \"D1:FILE.BAS\", \"D2:FILE.BAS\", \"FILE.BAS\"\n    let pattern = /^D([1-8])?:(.+)$/\n    if let match = filename.match(pattern) {\n        let drive = match.1.map { Int(String($0))! } ?? 1\n        return (drive, String(match.2))\n    }\n    return (1, filename)  // Default to D1:\n}\n```\n\n### Task 4: Error Handling\n\nAdd error cases:\n- `REPLError.fileNotFound(String)`\n- `REPLError.driveNotMounted(Int)`\n- `REPLError.diskFull`\n- `REPLError.invalidBASICFile`\n\n## Dependencies\n\n- Keyboard injection (parent issue) should be implemented first for the \"inject into memory\" step\n- Or use existing memory injection if that approach is retained for full-program loading\n\n## Testing\n\n1. Create ATR with BASIC program, LOAD it, verify LIST shows correct content\n2. Enter program via keyboard, SAVE to ATR, verify file on disk\n3. Round-trip: LOAD → modify → SAVE → LOAD again\n4. Error cases: file not found, disk not mounted, disk full\n\n## Notes\n\n- ATR filesystem supports both tokenized (.BAS binary) and source (.LST text) formats\n- Consider supporting both formats based on file extension\n- libatari800 also has native disk I/O which could be used alternatively","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-03T09:53:57.802094-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-03T09:53:57.802094-08:00"}
{"id":"attic-fwj","title":"Implement file open handler in AtticGUI","description":"Stub for double-click handling. Need to handle .atr files (mount) and .attic files (load state). File: Sources/AtticGUI/AtticApp.swift:158","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:29.107058-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:29.107058-08:00","labels":["future"]}
{"id":"attic-iuq","title":"Implement keyboard injection in AtticServer","description":"Currently acknowledges but doesn't process. Need to buffer keystrokes and inject them into the emulator input queue. File: Sources/AtticServer/main.swift:480","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:16.572995-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:16.572995-08:00","labels":["future"]}
{"id":"attic-j32","title":"Figure out this whole beads sync thing","status":"in_progress","priority":0,"issue_type":"task","assignee":"Nikolai Schlegel","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T22:37:52.445833-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T22:52:42.279635-08:00"}
{"id":"attic-k1j","title":".shutdown command only exits CLI, does not stop AtticServer or AtticGUI","description":"When issuing the '.shutdown' command in the attic CLI:\n- The CLI exits\n- AtticServer continues running\n- AtticGUI continues running\n\n**Expected behavior:**\nThe .shutdown command should gracefully shut down the entire emulator system including AtticServer and AtticGUI, or at minimum provide feedback about what it actually does.\n\n**Possible solutions:**\n1. Send a shutdown command to AtticServer via the CLI protocol, which then notifies connected GUI clients\n2. Rename to '.quit' or '.exit' if it's only meant to exit the CLI\n3. Add separate commands: '.exit' (CLI only) and '.shutdown' (full system)","status":"open","priority":2,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-01T16:29:17.084318-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-01T16:29:17.084318-08:00"}
{"id":"attic-klv","title":"Implement disassemble command in AtticCLI","description":"Command marked as not implemented in translator. Need to forward to server's disassemble command. File: Sources/AtticCLI/main.swift:419","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:16.880708-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:16.880708-08:00","labels":["future"]}
{"id":"attic-lqm","title":"This is an invalid issue","status":"tombstone","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-19T21:17:21.666874-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-19T21:19:37.861243-08:00","deleted_at":"2026-01-19T21:19:37.861243-08:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"attic-m8x","title":"Fix keyword suggestion algorithm in BASIC tokenizer","description":"Test testKeywordSuggestion failing in BASICTokenizerTests:\n\n**Failing assertions:**\n- suggestKeyword(\"PRIN\") returns \"POINT\" instead of \"PRINT\"\n- suggestKeyword(\"GOT\") returns \"LET\" instead of \"GOTO\"\n\n**Root cause:**\nThe keyword suggestion algorithm (likely using edit distance) is not correctly finding the closest match. \"PRIN\" should obviously match \"PRINT\" (1 character away), not \"POINT\" (2+ edits). Similarly \"GOT\" is 1 character from \"GOTO\" but returning \"LET\".\n\nThe algorithm may be:\n1. Using wrong distance metric\n2. Not considering prefix matching\n3. Sorting results incorrectly\n\n**Files:**\n- Tests/AtticCoreTests/BASICTokenizerTests.swift:403-406 (test)\n- Sources/AtticCore/ (keyword suggestion implementation)","status":"open","priority":2,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T08:36:25.698708-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T08:36:25.698708-08:00"}
{"id":"attic-mjn","title":"Implement BASIC renumber in REPL Engine","description":"Complex operation explicitly deferred. Need to: 1) Read all BASIC lines from memory, 2) Renumber lines with new start/step values, 3) Update all line number references (GOTO, GOSUB, etc.), 4) Rewrite program to memory. High complexity - requires parsing line references in statements. File: Sources/AtticCore/REPL/REPLEngine.swift:357-358","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:44.233682-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:44.233682-08:00","labels":["future"]}
{"id":"attic-nmp","title":"Implement shutdown signal in REPL Engine","description":"Doesn't signal GUI to exit. Need to send shutdown command to GUI via socket. File: Sources/AtticCore/REPL/REPLEngine.swift:207","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:30.070986-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:30.070986-08:00","labels":["future"]}
{"id":"attic-npk","title":"Xcode build errors for Attic","description":"Attic\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticServer/main.swift\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticServer/main.swift:669:1 'main' attribute cannot be used in a module that contains top-level code\n\nAtticCore\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCore/BASICLineHandler.swift\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCore/BASICLineHandler.swift:625:21 No 'async' operations occur within 'await' expression\n\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCore/BASICLineHandler.swift:632:9 No 'async' operations occur within 'await' expression\n\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCore/BASICLineHandler.swift:641:9 No 'async' operations occur within 'await' expression\n\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCore/BASICLineHandler.swift:646:9 No 'async' operations occur within 'await' expression\n\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCore/CLISocketClient.swift\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCore/CLISocketClient.swift:326:17 No 'async' operations occur within 'await' expression\n\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCore/CLISocketClient.swift:374:17 No 'async' operations occur within 'await' expression","status":"closed","priority":0,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-19T22:13:25.334368-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T08:40:52.498117-08:00","closed_at":"2026-01-20T08:40:52.498117-08:00","close_reason":"Build errors resolved - Xcode now builds successfully","dependencies":[{"issue_id":"attic-npk","depends_on_id":"attic-ek7","type":"blocks","created_at":"2026-01-20T07:55:27.687761-08:00","created_by":"Nikolai Schlegel"},{"issue_id":"attic-npk","depends_on_id":"attic-c4f","type":"blocks","created_at":"2026-01-20T08:03:49.136632-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-oak","title":"The more, the merrier, beads","status":"closed","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-31T22:05:08.994835-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-31T22:22:20.585775-08:00","closed_at":"2026-01-31T22:22:20.585775-08:00","close_reason":"Closed as requested"}
{"id":"attic-opj","title":"Update the documentation with respect to how to build \u0026 run the project with Xcode","status":"closed","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T07:57:23.198572-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T08:49:51.466672-08:00","closed_at":"2026-01-20T08:49:51.466672-08:00","close_reason":"Added Xcode build/run instructions to CLAUDE.md and fixed incorrect Attic.xcodeproj reference in README.md (this is an SPM project opened via Package.swift)"}
{"id":"attic-qps","title":"Set up beads across all development machines","status":"open","priority":1,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T22:13:40.889293-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T22:13:40.889293-08:00"}
{"id":"attic-qvv","title":"Merge the docs/PHASE_14_DESIGN.md document into the existing architecture and other specification docs and remove it","status":"closed","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T07:59:13.776906-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T08:57:02.434888-08:00","closed_at":"2026-01-20T08:57:02.434888-08:00","close_reason":"Merged architectural decisions into ARCHITECTURE.md, added tokenization examples to BASIC_TOKENIZER.md, and removed PHASE_14_DESIGN.md"}
{"id":"attic-rg4","title":"Implement Open Disk Image menu in AtticGUI","description":"Menu item has no action. Need to present NSOpenPanel filtered for .atr files. File: Sources/AtticGUI/AtticApp.swift:806","status":"open","priority":4,"issue_type":"feature","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T09:00:29.263882-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T09:00:29.263882-08:00","labels":["future"]}
{"id":"attic-s12","title":"Build errors with Xcode","description":"attic\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCLI/main.swift\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCLI/main.swift:38:1 'main' attribute cannot be used in a module that contains top-level code\n\nattic\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCLI/main.swift\n/Users/nikolai/Source/Repos/GitHub/huegli/attic/Sources/AtticCLI/main.swift:38:1 'main' attribute cannot be used in a module that contains top-level code\n","status":"closed","priority":0,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-19T22:05:44.651931-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-19T22:09:47.530255-08:00","closed_at":"2026-01-19T22:09:47.530255-08:00","close_reason":"Fixed by renaming main.swift to AtticCLI.swift - Swift does not allow @main in a file named main.swift"}
{"id":"attic-u0y","title":"Remove unnecessary await expressions in async code","description":"Swift compiler warnings: 'No async operations occur within await expression'. Locations:\n- BASICLineHandler.swift:625, 632, 641, 646\n- CLISocketClient.swift:326, 374\n\nThese awaits are unnecessary and should be removed to clean up the async code.","status":"open","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T08:44:46.701588-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T08:44:46.701588-08:00"}
{"id":"attic-upp","title":"13. Error Handling Tests","description":"Manual testing for missing ROMs, invalid files, and network errors","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:27.217949-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:27.217949-08:00","dependencies":[{"issue_id":"attic-upp","depends_on_id":"attic-69h","type":"blocks","created_at":"2026-01-20T12:22:49.541571-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-upp.1","title":"13.1 Missing ROMs","description":"Test clear error message when ROMs not found, suggestion for ROM location","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:25.309697-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:25.309697-08:00","dependencies":[{"issue_id":"attic-upp.1","depends_on_id":"attic-upp","type":"parent-child","created_at":"2026-01-20T12:24:25.310304-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-upp.2","title":"13.2 Invalid Files","description":"Test invalid ATR shows error, corrupt state file shows error, error includes filename","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:25.535564-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:25.535564-08:00","dependencies":[{"issue_id":"attic-upp.2","depends_on_id":"attic-upp","type":"parent-child","created_at":"2026-01-20T12:24:25.536201-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-upp.3","title":"13.3 Network Errors","description":"Test server not found shows helpful message, connection timeout handled, reconnection possible","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:32.133953-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:32.133953-08:00","dependencies":[{"issue_id":"attic-upp.3","depends_on_id":"attic-upp","type":"parent-child","created_at":"2026-01-20T12:24:32.136626-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-uyu","title":"Fix save state crash in debug builds","description":"**Problem:**\nThe '.save state' command crashes with SIGBUS in debug builds but works in release builds.\n\n**Root cause:**\nDebug builds have larger stack frames due to debug symbols and less inlining. The combination of:\n1. Deep async call chain (CLISocketServer -\u003e processLine -\u003e delegate -\u003e EmulatorEngine -\u003e wrapper)\n2. Debug build overhead per stack frame\n3. libatari800_get_current_state internal stack usage (~210KB state struct)\n\n...exceeds Swift Task's ~512KB stack limit in debug mode.\n\n**Current workaround:**\nUse release builds: `swift build -c release`\n\n**Proposed fixes:**\n1. Use pthread_create with custom stack size (1MB+) for the save operation\n2. Restructure to reduce async call depth\n3. Move heavy operations to a dedicated thread pool with larger stacks\n\n**Related:**\n- Previous fix attempts in LibAtari800Wrapper.swift (heap allocation, memset, DispatchQueue.sync)\n- Original crash: attic-zqq (closed)\n- Partial fix: attic-52y (closed)","status":"closed","priority":2,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-01T15:36:55.318955-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-01T15:43:41.878711-08:00","closed_at":"2026-02-01T15:43:41.878711-08:00","close_reason":"Merged back into attic-52y - crash affects release builds too"}
{"id":"attic-wmz","title":"AtticServer crashes with SIGBUS on .load state command","description":"When issuing '.load state \u003cfilename\u003e' through the attic CLI to load a previously saved state, AtticServer crashes with SIGBUS (exit code 138).\n\n**Root cause (likely):**\nSame stack overflow issue as save state - the restoreState() function in LibAtari800Wrapper needs the same main thread dispatch fix that was applied to saveState().\n\n**Fix:**\nApply the same DispatchQueue.main.sync pattern to restoreState() that fixed saveState().","status":"closed","priority":1,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-01T16:09:24.855913-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-01T16:13:58.799522-08:00","closed_at":"2026-02-01T16:13:58.799522-08:00","close_reason":"Fixed by dispatching restoreState to main thread (8MB stack) - same pattern as saveState fix"}
{"id":"attic-x3f","title":"Let's make more beads","status":"closed","priority":1,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-23T13:48:36.30942-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-31T21:43:03.75359-08:00","closed_at":"2026-01-31T21:43:03.75359-08:00","close_reason":"Closed"}
{"id":"attic-x65","title":"Let's make so much more beads","status":"closed","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-28T19:39:05.099198-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-28T21:09:01.935543-08:00","closed_at":"2026-01-28T21:09:01.935543-08:00","close_reason":"Closed"}
{"id":"attic-y2m","title":"LIST command in AtticServer returns placeholder instead of actual program listing","description":"## Problem\n\nWhen using the `list` command in the CLI (socket mode), the server returns only placeholder info like \"program 0 lines, 3 bytes, 0 variables\" instead of the actual BASIC program listing.\n\n## Root Cause\n\nIn `Sources/AtticServer/AtticServer.swift` lines 569-572, the `basicList` handler returns placeholder info:\n\n```swift\ncase .basicList:\n    // LIST requires detokenizer (Phase 15), show program info instead\n    let info = await basicHandler.getProgramInfo()\n    return .ok(\"program \\(info.lines) lines, \\(info.bytes) bytes, \\(info.variables) variables\")\n```\n\nThe comment says \"LIST requires detokenizer (Phase 15)\" but the detokenizer already exists and works:\n- `BASICDetokenizer.swift` is fully implemented\n- `BASICLineHandler.listProgram(range:)` method properly detokenizes and returns listings\n- `REPLEngine.swift` lines 376-386 uses it correctly for local mode\n\n## Two Code Paths\n\n1. **REPLEngine (local mode)** - Works correctly, calls `basicHandler.listProgram()`\n2. **AtticServer (socket mode)** - Broken, returns placeholder instead of calling detokenizer\n\n## Fix Required\n\nChange `AtticServer.swift` to call the existing `listProgram()` method:\n\n```swift\ncase .basicList:\n    let listing = await basicHandler.listProgram(range: nil)\n    if listing.isEmpty {\n        return .ok(\"No program in memory\")\n    }\n    return .ok(listing)\n```\n\n## Files Involved\n\n- `Sources/AtticServer/AtticServer.swift:569-572` - The broken handler (needs fix)\n- `Sources/AtticCore/BASICLineHandler.swift:565-589` - Working `listProgram()` method\n- `Sources/AtticCore/BASICDetokenizer.swift` - Working detokenizer\n- `Sources/AtticCore/REPLEngine.swift:376-386` - Reference implementation that works","notes":"### Reopened: Multi-line listing broken\n\nThe fix works for single-line programs but fails for multi-line programs. The CLI response parser fails to handle multiple lines in the listing.\n\n**Test case:**\n```\n10 REM HELLO\n20 PRINT \"HELLO\"\n30 A=42\nlist\n```\n\n**Output:**\n```\n[CLIClient] Failed to parse response: unexpectedResponse(\"20 PRINT \\\"HELLO\\\"\")\n[CLIClient] Failed to parse response: unexpectedResponse(\"30 A= 42\")\n10 REM HELLO\n```\n\n**Root cause:** The server sends a multi-line response, but each subsequent line (without OK: prefix) is being rejected by the client's response parser.\n\nNeed to check how multi-line responses are formatted and parsed in CLIProtocol.","status":"closed","priority":2,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-02T16:59:28.217584-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-03T00:36:13.485424-08:00","closed_at":"2026-02-03T00:36:13.485424-08:00","close_reason":"Fixed multi-line listing. Changed from .ok(listing) to .okMultiLine(lines) which uses the Record Separator (U+001E) as the line delimiter instead of newline. Verified the protocol output shows the correct separator between lines."}
{"id":"attic-yf8","title":"This is a new beads task","status":"closed","priority":1,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-31T21:53:18.016014-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-31T22:29:16.227181-08:00","closed_at":"2026-01-31T22:25:51.426423-08:00"}
{"id":"attic-yhd","title":"A 3rd level beads","status":"tombstone","priority":3,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-22T18:42:46.798257-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-22T21:55:35.604256-08:00","deleted_at":"2026-01-22T21:55:35.604256-08:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"attic-yz4","title":"7. Disassembler Tests","description":"Manual testing for basic disassembly, addressing modes, and illegal opcodes","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:17.09186-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:17.09186-08:00","dependencies":[{"issue_id":"attic-yz4","depends_on_id":"attic-0de","type":"blocks","created_at":"2026-01-20T12:22:42.840353-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-yz4.1","title":"7.1 Basic Disassembly","description":"Test d $E000 shows ROM code with address, bytes, mnemonic, operand, known labels","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:41.668586-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:41.668586-08:00","dependencies":[{"issue_id":"attic-yz4.1","depends_on_id":"attic-yz4","type":"parent-child","created_at":"2026-01-20T12:23:41.669199-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-yz4.2","title":"7.2 Addressing Modes","description":"Test disassembly of all addressing modes: Immediate, Zero Page, Absolute, Indexed X/Y, Indirect, Indexed Indirect, Indirect Indexed, Relative with offset","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:54.901947-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:54.901947-08:00","dependencies":[{"issue_id":"attic-yz4.2","depends_on_id":"attic-yz4","type":"parent-child","created_at":"2026-01-20T12:23:54.904149-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-yz4.3","title":"7.3 Illegal Opcodes","description":"Test illegal opcodes marked and disassembled correctly (LAX, SAX, DCP, etc.)","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:23:55.158508-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:23:55.158508-08:00","dependencies":[{"issue_id":"attic-yz4.3","depends_on_id":"attic-yz4","type":"parent-child","created_at":"2026-01-20T12:23:55.159129-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-z1v","title":"11. State Persistence Tests","description":"Manual testing for save state, load state, and state integrity","status":"open","priority":2,"issue_type":"epic","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:22:26.896102-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:22:26.896102-08:00","dependencies":[{"issue_id":"attic-z1v","depends_on_id":"attic-3j2","type":"blocks","created_at":"2026-01-20T12:22:49.218837-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-z1v.1","title":"11.1 Save State","description":"Test state save creates ~210KB+ file, error on invalid path","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:09.846668-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:09.846668-08:00","dependencies":[{"issue_id":"attic-z1v.1","depends_on_id":"attic-z1v","type":"parent-child","created_at":"2026-01-20T12:24:09.847231-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-z1v.2","title":"11.2 Load State","description":"Test state load restores screen, memory, REPL mode; error on invalid file/wrong format version","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:24.147971-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:24.147971-08:00","dependencies":[{"issue_id":"attic-z1v.2","depends_on_id":"attic-z1v","type":"parent-child","created_at":"2026-01-20T12:24:24.150149-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-z1v.3","title":"11.3 State Integrity","description":"Test save mid-game, modify, load restores original; multiple save/load cycles work","status":"open","priority":2,"issue_type":"task","owner":"nikolai.schlegel@gmail.com","created_at":"2026-01-20T12:24:24.386375-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-01-20T12:24:24.386375-08:00","dependencies":[{"issue_id":"attic-z1v.3","depends_on_id":"attic-z1v","type":"parent-child","created_at":"2026-01-20T12:24:24.38704-08:00","created_by":"Nikolai Schlegel"}]}
{"id":"attic-zqq","title":"AtticServer crashes with Bus error when saving state via CLI","description":"When using the '.save state \u003cfilename\u003e' command from attic CLI connected to AtticServer, the server crashes with SIGBUS (Bus error).\n\n**Crash location:**\n- EmulatorEngine.saveState(to:metadata:) at EmulatorEngine.swift:601\n- Specifically at: wrapper.saveState()\n\n**Stack trace:**\n1. ___chkstk_darwin in libsystem_pthread.dylib (stack check)\n2. EmulatorEngine.saveState() calling wrapper.saveState()\n3. CLIServerDelegate handling .saveState command\n4. CLISocketServer processing client command\n\n**Error details:**\n- Signal: SIGBUS (Misaligned address error)\n- Address: 0x000000016b9afff8\n- Platform: arm64 macOS 26.2\n\n**Root cause hypothesis:**\nThe crash in ___chkstk_darwin suggests a stack overflow. The libatari800 saveState() function likely allocates a large buffer on the stack that exceeds the thread's stack size. The CLI command runs on a detached Task which may have a smaller default stack size.\n\n**Possible fixes:**\n1. Increase stack size for the client handler thread\n2. Dispatch saveState to main thread or a thread with larger stack\n3. Modify libatari800 wrapper to use heap allocation instead of stack","status":"closed","priority":1,"issue_type":"bug","owner":"nikolai.schlegel@gmail.com","created_at":"2026-02-01T12:46:25.755509-08:00","created_by":"Nikolai Schlegel","updated_at":"2026-02-01T12:48:16.0477-08:00","closed_at":"2026-02-01T12:48:16.0477-08:00","close_reason":"Fixed stack overflow by allocating emulator_state_t (~210KB) on the heap instead of stack in saveState() and restoreState()"}
